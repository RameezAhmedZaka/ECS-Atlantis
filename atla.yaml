version: 3
projects:
  - name: adot-dev-deploy
    dir: applications/adot
    workspace: development
    workflow: dev-workflow
    apply_requirements: []
    autoplan:
      when_modified: ["*.tf", "config/*.tfvars", "modules/**/*.tf", "**/*.tf"]
      enabled: true

  - name: adot-prod-deploy
    dir: applications/adot
    workspace: production
    workflow: prod-workflow
    apply_requirements: []
    autoplan:
      when_modified: ["*.tf", "config/*.tfvars", "modules/**/*.tf", "**/*.tf"]
      enabled: true

  - name: apollo-dev-deploy
    dir: applications/apollo
    workspace: development
    workflow: dev-workflow
    apply_requirements: []
    autoplan:
      when_modified: ["*.tf", "config/*.tfvars", "modules/**/*.tf", "**/*.tf"]
      enabled: true

  - name: apollo-prod-deploy
    dir: applications/apollo
    workspace: production
    workflow: prod-workflow
    apply_requirements: []
    autoplan:
      when_modified: ["*.tf", "config/*.tfvars", "modules/**/*.tf", "**/*.tf"]
      enabled: true

workflows:
  dev-workflow:
    plan:
      steps:
        - run:
            command: ls
        - init:
            extra_args: ["-backend-config=env/staging/stage.conf"]
        - plan: 
            extra_args: ["-var-file=config/stage.tfvars"]
    apply:
      steps:
        - apply:
            extra_args: ["-var-file=config/stage.tfvars"]

  prod-workflow:
    plan:
      steps:
        - run:
            command: ls
        - init:
            extra_args: ["-backend-config=env/production/prod.conf"]
        - plan: 
            extra_args: ["-var-file=./config/production.tfvars"]
    apply:
      steps:
        - apply:
            extra_args: ["-var-file=./config/production.tfvars"]
