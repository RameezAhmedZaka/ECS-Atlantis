version: 3
automerge: true
parallel_plan: true
parallel_apply: true

projects:
  - name: apps-staging
    dir: application
    workspace: staging
    autoplan:
      enabled: true
      when_modified:
        - "application/**/*.tf"
        - "application/config/*.tfvars"
    workflow: run-script

  - name: apps-production
    dir: application
    workspace: production
    autoplan:
      enabled: true
      when_modified:
        - "application/**/*.tf"
        - "application/config/*.tfvars"
    workflow: run-script

workflows:
  run-script:
    plan:
      steps:
        - run: terraform_env.sh
    apply:
      steps:
        - run: terraform_env.sh
